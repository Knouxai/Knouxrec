<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KNOUX REC - Ù…Ø³Ø¬Ù„ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Cairo",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        color: white;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Ø®Ø·ÙˆØ· ÙƒØ§ÙŠØ±Ùˆ */
      @import url("https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap");

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 30px;
        margin: 20px 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .logo {
        font-size: 3rem;
        font-weight: 900;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #00ffff;
        font-size: 1.2rem;
        margin-bottom: 20px;
      }

      .controls-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .control-panel {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 15px;
        padding: 25px;
        border: 1px solid rgba(0, 255, 255, 0.3);
      }

      .control-panel h3 {
        color: #00ffff;
        margin-bottom: 20px;
        font-size: 1.3rem;
        text-align: center;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
        font-size: 1rem;
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-record {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .btn-stop {
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      }

      .btn-download {
        background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
      }

      .status {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
      }

      .status.idle {
        background: rgba(108, 117, 125, 0.2);
        color: #6c757d;
      }

      .status.recording {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
        animation: pulse 2s infinite;
      }

      .status.ready {
        background: rgba(40, 167, 69, 0.2);
        color: #28a745;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .timer {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
        color: #00ffff;
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .feature-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        border: 1px solid rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
      }

      .feature-card:hover {
        transform: translateY(-5px);
        border-color: #00ffff;
      }

      .feature-icon {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .feature-title {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: #00ffff;
      }

      .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .template-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .template-card:hover {
        background: rgba(102, 126, 234, 0.2);
        transform: scale(1.05);
      }

      .projects-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .project-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        margin: 10px 0;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .achievement {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        padding: 10px 20px;
        border-radius: 20px;
        margin: 5px;
        display: inline-block;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(243, 156, 18, 0.3);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #00ffff;
      }

      .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
      }

      .floating-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #00ffff;
        border-radius: 50%;
        animation: float 6s infinite linear;
      }

      @keyframes float {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      .record-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        font-weight: bold;
        display: none;
        z-index: 1000;
        animation: pulse 1s infinite;
      }

      .notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        font-weight: bold;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
      }

      .footer {
        text-align: center;
        margin-top: 50px;
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.6);
      }
    </style>
  </head>
  <body>
    <!-- Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="floating-particles" id="particles"></div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div class="record-indicator" id="recordIndicator">ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>

    <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="notification" id="notification"></div>

    <div class="container">
      <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
      <div class="header">
        <h1 class="logo">KNOUX REC</h1>
        <p class="subtitle">Ù…Ø³Ø¬Ù„ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
        <div class="timer" id="timer">00:00:00</div>
      </div>

      <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
      <div class="status idle" id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ø¬ÙŠÙ„</div>

      <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div class="glass-card">
        <div class="controls-grid">
          <div class="control-panel">
            <h3>ğŸ¬ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
            <button
              class="btn btn-record"
              id="recordBtn"
              onclick="startRecording()"
            >
              ğŸ”´ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </button>
            <button
              class="btn btn-stop"
              id="stopBtn"
              onclick="stopRecording()"
              disabled
            >
              â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </button>
            <button class="btn" onclick="takeScreenshot()">ğŸ“¸ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©</button>
          </div>

          <div class="control-panel">
            <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
            <select id="qualitySelect" class="btn">
              <option value="720p">HD 720p</option>
              <option value="1080p" selected>Full HD 1080p</option>
              <option value="4k">4K Ultra HD</option>
            </select>
            <select id="fpsSelect" class="btn">
              <option value="30">30 FPS</option>
              <option value="60" selected>60 FPS</option>
              <option value="120">120 FPS</option>
            </select>
            <label style="display: block; margin: 10px 0">
              <input type="checkbox" id="audioCheck" checked /> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª
            </label>
          </div>

          <div class="control-panel">
            <h3>ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
            <button class="btn" onclick="createProject()">ğŸ“ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button>
            <button
              class="btn btn-download"
              id="downloadBtn"
              onclick="downloadRecording()"
              disabled
            >
              ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </button>
            <button class="btn" onclick="openProjects()">
              ğŸ“‚ ÙØªØ­ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            </button>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ù…ÙŠØ²Ø§Øª ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª -->
      <div class="glass-card">
        <h2 style="text-align: center; color: #00ffff; margin-bottom: 30px">
          ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Øª
        </h2>
        <div class="features-grid">
          <div class="feature-card" onclick="openTemplates()">
            <div class="feature-icon">ğŸ“½ï¸</div>
            <div class="feature-title">Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</div>
            <p>Ù…Ù‚Ø¯Ù…Ø§Øª ÙˆØ®ÙˆØ§ØªÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ©</p>
          </div>
          <div class="feature-card" onclick="openAudioTools()">
            <div class="feature-icon">ğŸµ</div>
            <div class="feature-title">Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµÙˆØª</div>
            <p>ØªØ­Ø³ÙŠÙ† ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØª</p>
          </div>
          <div class="feature-card" onclick="openEffects()">
            <div class="feature-icon">âœ¨</div>
            <div class="feature-title">Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª</div>
            <p>ÙÙ„Ø§ØªØ± ÙˆØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ©</p>
          </div>
          <div class="feature-card" onclick="openAI()">
            <div class="feature-icon">ğŸ¤–</div>
            <div class="feature-title">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
            <p>Ù…Ø¹Ø§Ù„Ø¬Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø°ÙƒÙŠØ©</p>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ -->
      <div class="glass-card" id="templatesSection" style="display: none">
        <h3>ğŸ“½ï¸ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</h3>
        <div class="templates-grid">
          <div class="template-card" onclick="useTemplate('intro')">
            <div style="font-size: 2rem">ğŸ¬</div>
            <div>Ù…Ù‚Ø¯Ù…Ø© Ø§Ø­ØªØ±Ø§ï¿½ï¿½ÙŠØ©</div>
          </div>
          <div class="template-card" onclick="useTemplate('outro')">
            <div style="font-size: 2rem">ğŸ­</div>
            <div>Ø®Ø§ØªÙ…Ø© Ø§Ø´ØªØ±Ø§Ùƒ</div>
          </div>
          <div class="template-card" onclick="useTemplate('lower-third')">
            <div style="font-size: 2rem">ğŸ“º</div>
            <div>Ø¹Ù†ÙˆØ§Ù† Ø³ÙÙ„ÙŠ</div>
          </div>
          <div class="template-card" onclick="useTemplate('transition')">
            <div style="font-size: 2rem">ğŸ”„</div>
            <div>Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø¯ÙŠØ«</div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
      <div class="glass-card" id="projectsSection" style="display: none">
        <h3>ğŸ“ Ù…Ø´Ø§Ø±ÙŠØ¹ÙŠ</h3>
        <div class="projects-list" id="projectsList">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>

      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª -->
      <div class="glass-card">
        <h3 style="text-align: center; color: #00ffff; margin-bottom: 20px">
          ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalRecordings">0</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalProjects">0</div>
            <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalTime">0</div>
            <div class="stat-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="achievements">0</div>
            <div class="stat-label">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
          </div>
        </div>

        <div style="margin-top: 20px; text-align: center">
          <h4 style="color: #f39c12; margin-bottom: 15px">ğŸ† Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ</h4>
          <div id="achievementsList">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
          </div>
        </div>
      </div>

      <!-- Ø§Ù„ÙÙˆØªØ± -->
      <div class="footer">
        <p>Â© 2024 KNOUX REC - Ù…Ø³Ø¬Ù„ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
        <p>Ù…Ø·ÙˆØ± Ø¨Ù€ â¤ï¸ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</p>
      </div>
    </div>

    <script>
      // Ù…ØªØºÙŠØ±Ø§Øª Ø§ï¿½ï¿½ØªØ·Ø¨ÙŠÙ‚
      let mediaRecorder = null;
      let recordedChunks = [];
      let isRecording = false;
      let startTime = null;
      let timerInterval = null;
      let projects = JSON.parse(localStorage.getItem("knoux_projects") || "[]");
      let userStats = JSON.parse(
        localStorage.getItem("knoux_stats") ||
          '{"recordings": 0, "projects": 0, "totalTime": 0, "achievements": []}',
      );

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      document.addEventListener("DOMContentLoaded", function () {
        initializeParticles();
        updateStats();
        loadProjects();
        setupKeyboardShortcuts();

        showNotification("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ KNOUX REC! ğŸ¬", "success");
        console.log("âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© KNOUX REC Ø¨Ù†Ø¬Ø§Ø­");
      });

      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
      function initializeParticles() {
        const container = document.getElementById("particles");

        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 6 + "s";
          particle.style.animationDuration = Math.random() * 3 + 3 + "s";
          container.appendChild(particle);
        }
      }

      // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
      async function startRecording() {
        try {
          const constraints = {
            video: {
              mediaSource: "screen",
              width: { ideal: 1920 },
              height: { ideal: 1080 },
              frameRate: {
                ideal: parseInt(document.getElementById("fpsSelect").value),
              },
            },
            audio: document.getElementById("audioCheck").checked,
          };

          const stream =
            await navigator.mediaDevices.getDisplayMedia(constraints);

          mediaRecorder = new MediaRecorder(stream, {
            mimeType: "video/webm;codecs=vp9,opus",
            videoBitsPerSecond: 8000000,
          });

          recordedChunks = [];

          mediaRecorder.ondataavailable = function (event) {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = function () {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            const url = URL.createObjectURL(blob);

            // Ø¥Ù†Ø´Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
            const recording = {
              id: Date.now().toString(),
              name: `ØªØ³Ø¬ÙŠÙ„_${new Date().toLocaleDateString("ar-SA")}_${new Date().toLocaleTimeString("ar-SA")}`,
              url: url,
              blob: blob,
              size: blob.size,
              date: new Date().toISOString(),
              duration: Date.now() - startTime,
            };

            // Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            saveRecording(recording);

            // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById("downloadBtn").disabled = false;
            document.getElementById("downloadBtn").onclick = () =>
              downloadBlob(blob, recording.name + ".webm");

            showNotification("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰");
            unlockAchievement(
              "first-recording",
              "Ø£ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„",
              "Ù‚Ù…Øª Ø¨Ø£ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ù„Ùƒ!",
            );
          };

          mediaRecorder.start();
          isRecording = true;
          startTime = Date.now();

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          document.getElementById("recordBtn").disabled = true;
          document.getElementById("stopBtn").disabled = false;
          document.getElementById("status").className = "status recording";
          document.getElementById("status").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
          document.getElementById("recordIndicator").style.display = "block";

          // Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
          startTimer();

          showNotification("ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ”´");
        } catch (error) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:", error);
          showNotification("ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + error.message, "error");
        }
      }

      // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
      function stopRecording() {
        if (mediaRecorder && isRecording) {
          mediaRecorder.stop();
          mediaRecorder.stream.getTracks().forEach((track) => track.stop());

          isRecording = false;

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          document.getElementById("recordBtn").disabled = false;
          document.getElementById("stopBtn").disabled = true;
          document.getElementById("status").className = "status ready";
          document.getElementById("status").textContent =
            "Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„";
          document.getElementById("recordIndicator").style.display = "none";

          // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
          stopTimer();

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
          userStats.recordings++;
          userStats.totalTime += (Date.now() - startTime) / 1000 / 3600; // Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª
          saveStats();
          updateStats();

          showNotification("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„! âœ…");
        }
      }

      // Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©
      async function takeScreenshot() {
        try {
          const stream = await navigator.mediaDevices.getDisplayMedia({
            video: { mediaSource: "screen" },
          });

          const video = document.createElement("video");
          video.srcObject = stream;
          video.play();

          video.addEventListener("loadedmetadata", () => {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0);

            canvas.toBlob((blob) => {
              const url = URL.createObjectURL(blob);
              const link = document.createElement("a");
              link.href = url;
              link.download = `Ù„Ù‚Ø·Ø©_Ø´Ø§Ø´Ø©_${Date.now()}.png`;
              link.click();

              showNotification("ØªÙ… Ø­ÙØ¸ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©! ğŸ“¸");
            });

            stream.getTracks().forEach((track) => track.stop());
          });
        } catch (error) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©:", error);
          showNotification("ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©", "error");
        }
      }

      // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
      function startTimer() {
        timerInterval = setInterval(() => {
          const elapsed = Date.now() - startTime;
          const hours = Math.floor(elapsed / 3600000);
          const minutes = Math.floor((elapsed % 3600000) / 60000);
          const seconds = Math.floor((elapsed % 60000) / 1000);

          document.getElementById("timer").textContent =
            `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
        }, 1000);
      }

      // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
      function stopTimer() {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
      function createProject() {
        const name =
          prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯:") || `Ù…Ø´Ø±ÙˆØ¹ ${projects.length + 1}`;

        const project = {
          id: Date.now().toString(),
          name: name,
          type: "video",
          createdAt: Date.now(),
          recordings: [],
          status: "draft",
        };

        projects.push(project);
        saveProjects();
        loadProjects();

        userStats.projects++;
        saveStats();
        updateStats();

        showNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ "${name}" Ø¨Ù†Ø¬Ø§Ø­! ğŸ“`);
        unlockAchievement("first-project", "Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹", "Ø£Ù†Ø´Ø£Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ÙˆÙ„!");
      }

      // ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
      function openTemplates() {
        const section = document.getElementById("templatesSection");
        section.style.display =
          section.style.display === "none" ? "block" : "none";
      }

      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ù„Ø¨
      function useTemplate(templateType) {
        const templates = {
          intro: "Ù…Ù‚Ø¯Ù…Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©",
          outro: "Ø®Ø§ØªÙ…Ø© Ø§Ø´ØªØ±Ø§Ùƒ",
          "lower-third": "Ø¹Ù†ÙˆØ§Ù† Ø³ÙÙ„ÙŠ",
          transition: "Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø¯ÙŠØ«",
        };

        showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù„Ø¨ "${templates[templateType]}"! âœ¨`);
      }

      // ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
      function openProjects() {
        const section = document.getElementById("projectsSection");
        section.style.display =
          section.style.display === "none" ? "block" : "none";
      }

      // ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµÙˆØª
      function openAudioTools() {
        showNotification("ØªÙ… ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµÙˆØª! ğŸµ");
      }

      // ÙØªØ­ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
      function openEffects() {
        showNotification("ØªÙ… ÙØªØ­ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©! âœ¨");
      }

      // ÙØªØ­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
      function openAI() {
        showNotification("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ! ğŸ¤–");
      }

      // Ø­ÙØ¸ ØªØ³Ø¬ÙŠÙ„
      function saveRecording(recording) {
        let recordings = JSON.parse(
          localStorage.getItem("knoux_recordings") || "[]",
        );
        recordings.push(recording);
        localStorage.setItem("knoux_recordings", JSON.stringify(recordings));
      }

      // Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
      function saveProjects() {
        localStorage.setItem("knoux_projects", JSON.stringify(projects));
      }

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
      function loadProjects() {
        const projectsList = document.getElementById("projectsList");
        projectsList.innerHTML = "";

        if (projects.length === 0) {
          projectsList.innerHTML =
            '<div style="text-align: center; color: #666; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯</div>';
          return;
        }

        projects.forEach((project) => {
          const projectElement = document.createElement("div");
          projectElement.className = "project-item";
          projectElement.innerHTML = `
                    <h4>${project.name}</h4>
                    <p>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(project.createdAt).toLocaleDateString("ar-SA")}</p>
                    <p>Ø§Ù„Ù†ÙˆØ¹: ${project.type === "video" ? "ÙÙŠØ¯ÙŠÙˆ" : "ØµÙˆØª"}</p>
                    <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${project.status === "draft" ? "Ù…Ø³ÙˆØ¯Ø©" : "Ù…ÙƒØªÙ…Ù„"}</p>
                `;
          projectsList.appendChild(projectElement);
        });
      }

      // Ø­ÙØ¸ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      function saveStats() {
        localStorage.setItem("knoux_stats", JSON.stringify(userStats));
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      function updateStats() {
        document.getElementById("totalRecordings").textContent =
          userStats.recordings;
        document.getElementById("totalProjects").textContent =
          userStats.projects;
        document.getElementById("totalTime").textContent =
          userStats.totalTime.toFixed(1);
        document.getElementById("achievements").textContent =
          userStats.achievements.length;

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
        const achievementsList = document.getElementById("achievementsList");
        achievementsList.innerHTML = "";

        userStats.achievements.forEach((achievement) => {
          const achievementElement = document.createElement("div");
          achievementElement.className = "achievement";
          achievementElement.textContent = `${achievement.icon} ${achievement.name}`;
          achievementElement.title = achievement.description;
          achievementsList.appendChild(achievementElement);
        });
      }

      // Ø¥Ù„ØºØ§Ø¡ Ù‚ÙÙ„ Ø¥Ù†Ø¬Ø§Ø²
      function unlockAchievement(id, name, description, icon = "ğŸ†") {
        if (userStats.achievements.find((a) => a.id === id)) return;

        const achievement = {
          id,
          name,
          description,
          icon,
          unlockedAt: Date.now(),
        };
        userStats.achievements.push(achievement);
        saveStats();
        updateStats();

        showNotification(`ğŸ‰ Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯: ${name}!`, "achievement");
      }

      // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.style.display = "block";

        if (type === "error") {
          notification.style.background =
            "linear-gradient(135deg, #dc3545 0%, #c82333 100%)";
        } else if (type === "achievement") {
          notification.style.background =
            "linear-gradient(135deg, #f39c12 0%, #e67e22 100%)";
        } else {
          notification.style.background =
            "linear-gradient(135deg, #28a745 0%, #20c997 100%)";
        }

        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }

      // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù
      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        link.click();
        URL.revokeObjectURL(url);
      }

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
      function downloadRecording() {
        if (recordedChunks.length > 0) {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          downloadBlob(blob, `ØªØ³Ø¬ÙŠÙ„_${Date.now()}.webm`);
          showNotification("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„! ğŸ’¾");
        }
      }

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", (event) => {
          if (
            event.target.tagName === "INPUT" ||
            event.target.tagName === "TEXTAREA"
          )
            return;

          switch (event.key) {
            case "F9":
              event.preventDefault();
              if (!isRecording) startRecording();
              else stopRecording();
              break;
            case "F10":
              event.preventDefault();
              if (isRecording) stopRecording();
              break;
            case "F12":
              event.preventDefault();
              takeScreenshot();
              break;
          }
        });
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ù„Ù ÙƒØªØ·Ø¨ÙŠÙ‚ Ù…Ø³ØªÙ‚Ù„
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register(
            "data:text/javascript;base64,Ly8gU2VydmljZSBXb3JrZXIgZm9yIG9mZmxpbmUgc3VwcG9ydA==",
          )
          .then(() => console.log("Service Worker registered"))
          .catch(() => console.log("Service Worker registration failed"));
      }

      // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¨Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù† ÙˆF12 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø­Ù…Ø§ÙŠØ©)
      document.addEventListener("contextmenu", (e) => e.preventDefault());
      document.addEventListener("keydown", (e) => {
        if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I")) {
          if (!isRecording) e.preventDefault();
        }
      });

      console.log("ğŸ¬ KNOUX REC Standalone - Ready to Record!");
    </script>
  </body>
</html>
