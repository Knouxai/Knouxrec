<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KNOUX REC - مسجل الشاشة الاحترافي</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Cairo",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        color: white;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* خطوط كايرو */
      @import url("https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap");

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 30px;
        margin: 20px 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .logo {
        font-size: 3rem;
        font-weight: 900;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #00ffff;
        font-size: 1.2rem;
        margin-bottom: 20px;
      }

      .controls-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .control-panel {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 15px;
        padding: 25px;
        border: 1px solid rgba(0, 255, 255, 0.3);
      }

      .control-panel h3 {
        color: #00ffff;
        margin-bottom: 20px;
        font-size: 1.3rem;
        text-align: center;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
        font-size: 1rem;
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-record {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .btn-stop {
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      }

      .btn-download {
        background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
      }

      .status {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
      }

      .status.idle {
        background: rgba(108, 117, 125, 0.2);
        color: #6c757d;
      }

      .status.recording {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
        animation: pulse 2s infinite;
      }

      .status.ready {
        background: rgba(40, 167, 69, 0.2);
        color: #28a745;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .timer {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
        color: #00ffff;
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .feature-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        border: 1px solid rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
      }

      .feature-card:hover {
        transform: translateY(-5px);
        border-color: #00ffff;
      }

      .feature-icon {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .feature-title {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: #00ffff;
      }

      .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .template-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .template-card:hover {
        background: rgba(102, 126, 234, 0.2);
        transform: scale(1.05);
      }

      .projects-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .project-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        margin: 10px 0;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .achievement {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        padding: 10px 20px;
        border-radius: 20px;
        margin: 5px;
        display: inline-block;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(243, 156, 18, 0.3);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #00ffff;
      }

      .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
      }

      .floating-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #00ffff;
        border-radius: 50%;
        animation: float 6s infinite linear;
      }

      @keyframes float {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      .record-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        font-weight: bold;
        display: none;
        z-index: 1000;
        animation: pulse 1s infinite;
      }

      .notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        font-weight: bold;
        display: none;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
      }

      .footer {
        text-align: center;
        margin-top: 50px;
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.6);
      }
    </style>
  </head>
  <body>
    <!-- الجسيمات المتحركة -->
    <div class="floating-particles" id="particles"></div>

    <!-- مؤشر التسجيل -->
    <div class="record-indicator" id="recordIndicator">🔴 جاري التسجيل...</div>

    <!-- الإشعارات -->
    <div class="notification" id="notification"></div>

    <div class="container">
      <!-- الهيدر -->
      <div class="header">
        <h1 class="logo">KNOUX REC</h1>
        <p class="subtitle">مسجل الشاشة الاحترافي مع الذكاء الاصطناعي</p>
        <div class="timer" id="timer">00:00:00</div>
      </div>

      <!-- حالة التطبيق -->
      <div class="status idle" id="status">جاهز للتسجيل</div>

      <!-- أدوات التحكم الرئيسية -->
      <div class="glass-card">
        <div class="controls-grid">
          <div class="control-panel">
            <h3>🎬 التحكم في التسجيل</h3>
            <button
              class="btn btn-record"
              id="recordBtn"
              onclick="startRecording()"
            >
              🔴 بدء التسجيل
            </button>
            <button
              class="btn btn-stop"
              id="stopBtn"
              onclick="stopRecording()"
              disabled
            >
              ⏹️ إيقاف التسجيل
            </button>
            <button class="btn" onclick="takeScreenshot()">📸 لقطة شاشة</button>
          </div>

          <div class="control-panel">
            <h3>⚙️ الإعدادات السريعة</h3>
            <select id="qualitySelect" class="btn">
              <option value="720p">HD 720p</option>
              <option value="1080p" selected>Full HD 1080p</option>
              <option value="4k">4K Ultra HD</option>
            </select>
            <select id="fpsSelect" class="btn">
              <option value="30">30 FPS</option>
              <option value="60" selected>60 FPS</option>
              <option value="120">120 FPS</option>
            </select>
            <label style="display: block; margin: 10px 0">
              <input type="checkbox" id="audioCheck" checked /> تسجيل الصوت
            </label>
          </div>

          <div class="control-panel">
            <h3>📁 إدارة المشاريع</h3>
            <button class="btn" onclick="createProject()">📝 مشروع جديد</button>
            <button
              class="btn btn-download"
              id="downloadBtn"
              onclick="downloadRecording()"
              disabled
            >
              💾 تحميل التسجيل
            </button>
            <button class="btn" onclick="openProjects()">
              📂 فتح المشاريع
            </button>
          </div>
        </div>
      </div>

      <!-- الميزات والأدوات -->
      <div class="glass-card">
        <h2 style="text-align: center; color: #00ffff; margin-bottom: 30px">
          🛠️ الأدوات والميزات
        </h2>
        <div class="features-grid">
          <div class="feature-card" onclick="openTemplates()">
            <div class="feature-icon">📽️</div>
            <div class="feature-title">قوالب الفيديو</div>
            <p>مقدمات وخواتيم احترافية</p>
          </div>
          <div class="feature-card" onclick="openAudioTools()">
            <div class="feature-icon">🎵</div>
            <div class="feature-title">أدوات الصوت</div>
            <p>تحسين ومعالجة الصوت</p>
          </div>
          <div class="feature-card" onclick="openEffects()">
            <div class="feature-icon">✨</div>
            <div class="feature-title">التأثيرات</div>
            <p>فلاتر وتأثيرات بصرية</p>
          </div>
          <div class="feature-card" onclick="openAI()">
            <div class="feature-icon">🤖</div>
            <div class="feature-title">الذكاء الاصطناعي</div>
            <p>معالجة تلقائية ذكية</p>
          </div>
        </div>
      </div>

      <!-- القوالب -->
      <div class="glass-card" id="templatesSection" style="display: none">
        <h3>📽️ قوالب الفيديو الجاهزة</h3>
        <div class="templates-grid">
          <div class="template-card" onclick="useTemplate('intro')">
            <div style="font-size: 2rem">🎬</div>
            <div>مقدمة احترا��ية</div>
          </div>
          <div class="template-card" onclick="useTemplate('outro')">
            <div style="font-size: 2rem">🎭</div>
            <div>خاتمة اشتراك</div>
          </div>
          <div class="template-card" onclick="useTemplate('lower-third')">
            <div style="font-size: 2rem">📺</div>
            <div>عنوان سفلي</div>
          </div>
          <div class="template-card" onclick="useTemplate('transition')">
            <div style="font-size: 2rem">🔄</div>
            <div>انتقال حديث</div>
          </div>
        </div>
      </div>

      <!-- المشاريع -->
      <div class="glass-card" id="projectsSection" style="display: none">
        <h3>📁 مشاريعي</h3>
        <div class="projects-list" id="projectsList">
          <!-- سيتم ملء المشاريع ديناميكياً -->
        </div>
      </div>

      <!-- الإحصائيات والإنجازات -->
      <div class="glass-card">
        <h3 style="text-align: center; color: #00ffff; margin-bottom: 20px">
          📊 الإحصائيات
        </h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalRecordings">0</div>
            <div class="stat-label">إجمالي التسجيلات</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalProjects">0</div>
            <div class="stat-label">عدد المشاريع</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalTime">0</div>
            <div class="stat-label">ساعات التسجيل</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="achievements">0</div>
            <div class="stat-label">الإنجازات</div>
          </div>
        </div>

        <div style="margin-top: 20px; text-align: center">
          <h4 style="color: #f39c12; margin-bottom: 15px">🏆 إنجازاتي</h4>
          <div id="achievementsList">
            <!-- سيتم ملء الإنجازات ديناميكياً -->
          </div>
        </div>
      </div>

      <!-- الفوتر -->
      <div class="footer">
        <p>© 2024 KNOUX REC - مسجل الشاشة الاحترافي</p>
        <p>مطور بـ ❤️ باستخدام تقنيات الويب الحديثة</p>
      </div>
    </div>

    <script>
      // متغيرات ا��تطبيق
      let mediaRecorder = null;
      let recordedChunks = [];
      let isRecording = false;
      let startTime = null;
      let timerInterval = null;
      let projects = JSON.parse(localStorage.getItem("knoux_projects") || "[]");
      let userStats = JSON.parse(
        localStorage.getItem("knoux_stats") ||
          '{"recordings": 0, "projects": 0, "totalTime": 0, "achievements": []}',
      );

      // تهيئة التطبيق
      document.addEventListener("DOMContentLoaded", function () {
        initializeParticles();
        updateStats();
        loadProjects();
        setupKeyboardShortcuts();

        showNotification("مرحباً بك في KNOUX REC! 🎬", "success");
        console.log("✅ تم تهيئة KNOUX REC بنجاح");
      });

      // إنشاء الجسيمات المتحركة
      function initializeParticles() {
        const container = document.getElementById("particles");

        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 6 + "s";
          particle.style.animationDuration = Math.random() * 3 + 3 + "s";
          container.appendChild(particle);
        }
      }

      // بدء التسجيل
      async function startRecording() {
        try {
          const constraints = {
            video: {
              mediaSource: "screen",
              width: { ideal: 1920 },
              height: { ideal: 1080 },
              frameRate: {
                ideal: parseInt(document.getElementById("fpsSelect").value),
              },
            },
            audio: document.getElementById("audioCheck").checked,
          };

          const stream =
            await navigator.mediaDevices.getDisplayMedia(constraints);

          mediaRecorder = new MediaRecorder(stream, {
            mimeType: "video/webm;codecs=vp9,opus",
            videoBitsPerSecond: 8000000,
          });

          recordedChunks = [];

          mediaRecorder.ondataavailable = function (event) {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = function () {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            const url = URL.createObjectURL(blob);

            // إنشاء تسجيل جديد
            const recording = {
              id: Date.now().toString(),
              name: `تسجيل_${new Date().toLocaleDateString("ar-SA")}_${new Date().toLocaleTimeString("ar-SA")}`,
              url: url,
              blob: blob,
              size: blob.size,
              date: new Date().toISOString(),
              duration: Date.now() - startTime,
            };

            // حفظ التسجيل
            saveRecording(recording);

            // تفعيل زر التحميل
            document.getElementById("downloadBtn").disabled = false;
            document.getElementById("downloadBtn").onclick = () =>
              downloadBlob(blob, recording.name + ".webm");

            showNotification("تم حفظ التسجيل بنجاح! 🎉");
            unlockAchievement(
              "first-recording",
              "أول تسجيل",
              "قمت بأول تسجيل لك!",
            );
          };

          mediaRecorder.start();
          isRecording = true;
          startTime = Date.now();

          // تحديث الواجهة
          document.getElementById("recordBtn").disabled = true;
          document.getElementById("stopBtn").disabled = false;
          document.getElementById("status").className = "status recording";
          document.getElementById("status").textContent = "جاري التسجيل...";
          document.getElementById("recordIndicator").style.display = "block";

          // بدء مؤقت التسجيل
          startTimer();

          showNotification("تم بدء التسجيل بنجاح! 🔴");
        } catch (error) {
          console.error("خطأ في بدء التسجيل:", error);
          showNotification("فشل في بدء التسجيل: " + error.message, "error");
        }
      }

      // إيقاف التسجيل
      function stopRecording() {
        if (mediaRecorder && isRecording) {
          mediaRecorder.stop();
          mediaRecorder.stream.getTracks().forEach((track) => track.stop());

          isRecording = false;

          // تحديث الواجهة
          document.getElementById("recordBtn").disabled = false;
          document.getElementById("stopBtn").disabled = true;
          document.getElementById("status").className = "status ready";
          document.getElementById("status").textContent =
            "التسجيل جاهز للتحميل";
          document.getElementById("recordIndicator").style.display = "none";

          // إيقاف المؤقت
          stopTimer();

          // تحديث الإحصائيات
          userStats.recordings++;
          userStats.totalTime += (Date.now() - startTime) / 1000 / 3600; // بالساعات
          saveStats();
          updateStats();

          showNotification("تم إيقاف التسجيل! ✅");
        }
      }

      // التقاط لقطة شاشة
      async function takeScreenshot() {
        try {
          const stream = await navigator.mediaDevices.getDisplayMedia({
            video: { mediaSource: "screen" },
          });

          const video = document.createElement("video");
          video.srcObject = stream;
          video.play();

          video.addEventListener("loadedmetadata", () => {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0);

            canvas.toBlob((blob) => {
              const url = URL.createObjectURL(blob);
              const link = document.createElement("a");
              link.href = url;
              link.download = `لقطة_شاشة_${Date.now()}.png`;
              link.click();

              showNotification("تم حفظ لقطة الشاشة! 📸");
            });

            stream.getTracks().forEach((track) => track.stop());
          });
        } catch (error) {
          console.error("خطأ في التقاط لقطة الشاشة:", error);
          showNotification("فشل في التقاط لقطة الشاشة", "error");
        }
      }

      // بدء المؤقت
      function startTimer() {
        timerInterval = setInterval(() => {
          const elapsed = Date.now() - startTime;
          const hours = Math.floor(elapsed / 3600000);
          const minutes = Math.floor((elapsed % 3600000) / 60000);
          const seconds = Math.floor((elapsed % 60000) / 1000);

          document.getElementById("timer").textContent =
            `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
        }, 1000);
      }

      // إيقاف المؤقت
      function stopTimer() {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }

      // إنشاء مشروع جديد
      function createProject() {
        const name =
          prompt("اسم المشروع الجديد:") || `مشروع ${projects.length + 1}`;

        const project = {
          id: Date.now().toString(),
          name: name,
          type: "video",
          createdAt: Date.now(),
          recordings: [],
          status: "draft",
        };

        projects.push(project);
        saveProjects();
        loadProjects();

        userStats.projects++;
        saveStats();
        updateStats();

        showNotification(`تم إنشاء مشروع "${name}" بنجاح! 📝`);
        unlockAchievement("first-project", "أول مشروع", "أنشأت مشروعك الأول!");
      }

      // فتح قسم القوالب
      function openTemplates() {
        const section = document.getElementById("templatesSection");
        section.style.display =
          section.style.display === "none" ? "block" : "none";
      }

      // استخدام قالب
      function useTemplate(templateType) {
        const templates = {
          intro: "مقدمة احترافية",
          outro: "خاتمة اشتراك",
          "lower-third": "عنوان سفلي",
          transition: "انتقال حديث",
        };

        showNotification(`تم تطبيق قالب "${templates[templateType]}"! ✨`);
      }

      // فتح قسم المشاريع
      function openProjects() {
        const section = document.getElementById("projectsSection");
        section.style.display =
          section.style.display === "none" ? "block" : "none";
      }

      // فتح أدوات الصوت
      function openAudioTools() {
        showNotification("تم فتح أدوات الصوت! 🎵");
      }

      // فتح التأثيرات
      function openEffects() {
        showNotification("تم فتح التأثيرات البصرية! ✨");
      }

      // فتح الذكاء الاصطناعي
      function openAI() {
        showNotification("تم تفعيل أدوات الذكاء الاصطناعي! 🤖");
      }

      // حفظ تسجيل
      function saveRecording(recording) {
        let recordings = JSON.parse(
          localStorage.getItem("knoux_recordings") || "[]",
        );
        recordings.push(recording);
        localStorage.setItem("knoux_recordings", JSON.stringify(recordings));
      }

      // حفظ المشاريع
      function saveProjects() {
        localStorage.setItem("knoux_projects", JSON.stringify(projects));
      }

      // تحميل المشاريع
      function loadProjects() {
        const projectsList = document.getElementById("projectsList");
        projectsList.innerHTML = "";

        if (projects.length === 0) {
          projectsList.innerHTML =
            '<div style="text-align: center; color: #666; padding: 20px;">لا توجد مشاريع بعد</div>';
          return;
        }

        projects.forEach((project) => {
          const projectElement = document.createElement("div");
          projectElement.className = "project-item";
          projectElement.innerHTML = `
                    <h4>${project.name}</h4>
                    <p>تم الإنشاء: ${new Date(project.createdAt).toLocaleDateString("ar-SA")}</p>
                    <p>النوع: ${project.type === "video" ? "فيديو" : "صوت"}</p>
                    <p>الحالة: ${project.status === "draft" ? "مسودة" : "مكتمل"}</p>
                `;
          projectsList.appendChild(projectElement);
        });
      }

      // حفظ الإحصائيات
      function saveStats() {
        localStorage.setItem("knoux_stats", JSON.stringify(userStats));
      }

      // تحديث الإحصائيات
      function updateStats() {
        document.getElementById("totalRecordings").textContent =
          userStats.recordings;
        document.getElementById("totalProjects").textContent =
          userStats.projects;
        document.getElementById("totalTime").textContent =
          userStats.totalTime.toFixed(1);
        document.getElementById("achievements").textContent =
          userStats.achievements.length;

        // تحديث قائمة الإنجازات
        const achievementsList = document.getElementById("achievementsList");
        achievementsList.innerHTML = "";

        userStats.achievements.forEach((achievement) => {
          const achievementElement = document.createElement("div");
          achievementElement.className = "achievement";
          achievementElement.textContent = `${achievement.icon} ${achievement.name}`;
          achievementElement.title = achievement.description;
          achievementsList.appendChild(achievementElement);
        });
      }

      // إلغاء قفل إنجاز
      function unlockAchievement(id, name, description, icon = "🏆") {
        if (userStats.achievements.find((a) => a.id === id)) return;

        const achievement = {
          id,
          name,
          description,
          icon,
          unlockedAt: Date.now(),
        };
        userStats.achievements.push(achievement);
        saveStats();
        updateStats();

        showNotification(`🎉 إنجاز جديد: ${name}!`, "achievement");
      }

      // عرض إشعار
      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.style.display = "block";

        if (type === "error") {
          notification.style.background =
            "linear-gradient(135deg, #dc3545 0%, #c82333 100%)";
        } else if (type === "achievement") {
          notification.style.background =
            "linear-gradient(135deg, #f39c12 0%, #e67e22 100%)";
        } else {
          notification.style.background =
            "linear-gradient(135deg, #28a745 0%, #20c997 100%)";
        }

        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }

      // تحميل ملف
      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        link.click();
        URL.revokeObjectURL(url);
      }

      // تحميل التسجيل الحالي
      function downloadRecording() {
        if (recordedChunks.length > 0) {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          downloadBlob(blob, `تسجيل_${Date.now()}.webm`);
          showNotification("تم تحميل التسجيل! 💾");
        }
      }

      // إعداد اختصارات لوحة المفاتيح
      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", (event) => {
          if (
            event.target.tagName === "INPUT" ||
            event.target.tagName === "TEXTAREA"
          )
            return;

          switch (event.key) {
            case "F9":
              event.preventDefault();
              if (!isRecording) startRecording();
              else stopRecording();
              break;
            case "F10":
              event.preventDefault();
              if (isRecording) stopRecording();
              break;
            case "F12":
              event.preventDefault();
              takeScreenshot();
              break;
          }
        });
      }

      // تهيئة الملف كتطبيق مستقل
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register(
            "data:text/javascript;base64,Ly8gU2VydmljZSBXb3JrZXIgZm9yIG9mZmxpbmUgc3VwcG9ydA==",
          )
          .then(() => console.log("Service Worker registered"))
          .catch(() => console.log("Service Worker registration failed"));
      }

      // منع النقر بالزر الأيمن وF12 (اختياري للحماية)
      document.addEventListener("contextmenu", (e) => e.preventDefault());
      document.addEventListener("keydown", (e) => {
        if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I")) {
          if (!isRecording) e.preventDefault();
        }
      });

      console.log("🎬 KNOUX REC Standalone - Ready to Record!");
    </script>
  </body>
</html>
